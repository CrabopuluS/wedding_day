<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–≤–∞–¥—å–±–∞ ‚Äî –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</title>
  <meta name="description" content="–®–∞–±–ª–æ–Ω —Å–∞–π—Ç–∞‚Äë–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ —Å–≤–∞–¥—å–±—É: –¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –≤—Ä–µ–º—è, –≤–∏—à‚Äë–ª–∏—Å—Ç —Å –±—Ä–æ–Ω—å—é –ø–æ–¥–∞—Ä–∫–æ–≤." />
  <meta property="og:title" content="–°–≤–∞–¥–µ–±–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ" />
  <meta property="og:description" content="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É –ø—Ä–∞–∑–¥–Ω–∏–∫—É! –ó–¥–µ—Å—å ‚Äî –¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏ –≤–∏—à‚Äë–ª–∏—Å—Ç." />
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root {
      /* –¶–≤–µ—Ç–∞ */
      --bg: #f8fafc;
      --bg-2: #ffffff;
      --text: #0b1020;
      --muted: #5b6475;
      --accent: #7c5cff;         /* —Å–∏—Ä–µ–Ω–µ–≤–æ‚Äë—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
      --accent-2: #00c4b3;       /* –±–∏—Ä—é–∑–∞ */
      --danger: #ef4444;
      --ok: #10b981;

      /* –†–∞–¥–∏—É—Å—ã –∏ —Ç–µ–Ω–∏ */
      --r-lg: 24px;
      --r-md: 16px;
      --r-sm: 10px;
      --shadow-s: 0 1px 2px rgba(16, 24, 40, .06), 0 4px 12px rgba(16, 24, 40, .06);
      --shadow-m: 0 12px 24px rgba(16, 24, 40, .12);

      --container: 1100px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 400px at 10% -10%, rgba(124,92,255,.12), transparent 60%),
        radial-gradient(1200px 400px at 90% 0%, rgba(0,196,179,.10), transparent 60%),
        linear-gradient(180deg, #fff, var(--bg));
    }

    .container { max-width: var(--container); margin: 0 auto; padding: 24px; }

    /* –•–µ–¥–µ—Ä */
    header {
      position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(140%) blur(8px);
      background: color-mix(in srgb, #ffffff 80%, transparent);
      border-bottom: 1px solid #e8ecf3;
    }
    .nav { display: flex; align-items: center; gap: 16px; padding: 14px 24px; }
    .brand { font-weight: 700; letter-spacing: .3px; }
    .nav a { color: var(--muted); text-decoration: none; font-weight: 600; }
    .nav a:hover { color: var(--text); }
    .spacer { flex: 1; }
    .btn { appearance: none; border: none; border-radius: 999px; padding: 12px 18px; font-weight: 700; cursor: pointer; }
    .btn.primary { background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: #fff; box-shadow: var(--shadow-s); }
    .btn.ghost { background: #fff; color: var(--text); border: 1px solid #e8ecf3; }

    /* Hero */
    .hero { padding: 56px 24px 32px; text-align: center; }
    .chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 14px; border-radius: 999px; background: #fff; border: 1px solid #e8ecf3; color: var(--muted); font-weight: 600; box-shadow: var(--shadow-s); }
    h1 { font-size: clamp(40px, 6vw, 72px); margin: 18px 0 8px; line-height: 1.03; letter-spacing: -0.5px; }
    .names { background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .subtitle { color: var(--muted); font-size: clamp(18px, 2.8vw, 22px); }

    .cta { display: flex; justify-content: center; gap: 12px; margin-top: 24px; flex-wrap: wrap; }

    /* –°–µ–∫—Ü–∏–∏ */
    section { padding: 48px 0; }
    .section-title { font-size: clamp(26px, 3.4vw, 36px); margin: 0 0 16px; }
    .section-note { color: var(--muted); margin: 0 0 24px; }

    /* –ò–Ω—Ñ–æ‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ */
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .card { grid-column: span 12; background: var(--bg-2); border: 1px solid #e8ecf3; border-radius: var(--r-lg); box-shadow: var(--shadow-s); padding: 20px; }
    @media (min-width: 720px) { .card.sm-6 { grid-column: span 6; } .card.sm-4 { grid-column: span 4; } }

    .card h3 { margin: 2px 0 6px; font-size: 18px; letter-spacing: .2px; }
    .card p { margin: 0; color: var(--muted); }

    .timeline { position: relative; padding-left: 20px; }
    .timeline::before { content:""; position:absolute; left:8px; top:0; bottom:0; width:2px; background:#e8ecf3; }
    .t-item { position:relative; padding:14px 0 14px 12px; }
    .t-item::before { content:""; position:absolute; left:-2px; top:20px; width:10px; height:10px; background: var(--accent); border-radius:50%; box-shadow: 0 0 0 3px #f0edff; }
    .t-time { font-weight: 700; }

    /* –í–∏—à‚Äë–ª–∏—Å—Ç */
    .wish-grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .wish-card { grid-column: span 12; background:#fff; border:1px solid #edf0f6; border-radius: var(--r-md); padding:16px; display:flex; gap:14px; align-items:center; box-shadow: var(--shadow-s); }
    @media (min-width: 760px) { .wish-card { grid-column: span 6; } }
    @media (min-width: 1024px) { .wish-card { grid-column: span 4; } }
    .wish-thumb { width:64px; height:64px; border-radius: 12px; background: linear-gradient(120deg, rgba(124,92,255,.12), rgba(0,196,179,.12)); display:flex; align-items:center; justify-content:center; font-size:24px; }
    .wish-meta { flex:1; min-width:0; }
    .wish-title { margin:0 0 4px; font-weight:800; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .wish-note { margin:0; color: var(--muted); font-size:14px; }
    .wish-actions { display:flex; gap:10px; align-items:center; }
    .pill { padding:6px 10px; border-radius:999px; background:#f1f5f9; color:#334155; font-size:12px; font-weight:700; }
    .badge.reserved { background: #fef2f2; color: #991b1b; border: 1px dashed #fecaca; }
    .badge.free { background:#edfdf7; color:#065f46; border: 1px dashed #a7f3d0; }

    .filters { display:flex; gap:10px; align-items:center; margin-bottom: 12px; }

    /* –§—É—Ç–µ—Ä */
    footer { padding: 36px 24px 56px; color: var(--muted); text-align:center; }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º prefers-reduced-motion */
    @media (prefers-reduced-motion: no-preference) {
      .hero h1 { animation: rise .8s ease-out both; }
      @keyframes rise { from { opacity: 0; transform: translateY(6px); } to { opacity:1; transform:none; } }
    }
  </style>
</head>
<body>
  <header>
    <nav class="nav container" aria-label="–ì–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="brand">–ù–∞—à –¥–µ–Ω—å</div>
      <a href="#details">–î–µ—Ç–∞–ª–∏</a>
      <a href="#schedule">–ü—Ä–æ–≥—Ä–∞–º–º–∞</a>
      <a href="#wishlist">–í–∏—à‚Äë–ª–∏—Å—Ç</a>
      <span class="spacer"></span>
      <button class="btn ghost" id="mapBtn" type="button">–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è</button>
      <button class="btn primary" id="icsBtn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞—Ç—É</button>
    </nav>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container">
        <span class="chip" id="dateChip">–°—É–±–±–æ—Ç–∞, 30 –∞–≤–≥—É—Å—Ç–∞ 2025</span>
        <h1><span class="names" id="coupleNames">–ò–º—è & –ò–º—è</span></h1>
        <p class="subtitle" id="heroSubtitle">–ú—ã –±—É–¥–µ–º —Ä–∞–¥—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å –≤–∞–º–∏ –Ω–∞—à –ø—Ä–∞–∑–¥–Ω–∏–∫ –ª—é–±–≤–∏. –ó–¥–µ—Å—å –≤—Å—è –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –∫–æ–≥–¥–∞, –≥–¥–µ –∏ —á—Ç–æ –ø–æ–¥–∞—Ä–∏—Ç—å üí´</p>
        <div class="cta">
          <button class="btn primary" id="heroIcs" type="button">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
          <button class="btn ghost" id="heroMap" type="button">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>
      </div>
    </section>

    <!-- DETAILS -->
    <section id="details">
      <div class="container">
        <h2 class="section-title">–î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è</h2>
        <p class="section-note">–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ —á—É—Ç—å –∑–∞—Ä–∞–Ω–µ–µ. <strong>‚ö†Ô∏è –í—Ö–æ–¥ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–æ–ø—É—Å–∫–∞–º ‚Äî –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ–ø–∞–∑–¥—ã–≤–∞–π—Ç–µ!</strong></p>

        <div class="grid">
          <article class="card sm-4" aria-labelledby="whenTitle">
            <h3 id="whenTitle">–ö–æ–≥–¥–∞</h3>
            <p><strong id="dateText">30 –∞–≤–≥—É—Å—Ç–∞ 2025</strong></p>
            <p>–°–±–æ—Ä –≥–æ—Å—Ç–µ–π ‚Äî <strong id="startTime">16:00</strong>, —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å ‚Äî <strong id="ceremonyTime">17:00</strong></p>
          </article>

          <article class="card sm-4" aria-labelledby="whereTitle">
            <h3 id="whereTitle">–ì–¥–µ</h3>
            <p id="venueName"><strong>LOFT Venue</strong></p>
            <p id="venueAddr">–≥. _____, —É–ª. ________, 10</p>
            <div style="margin-top:10px; display:flex; gap:8px;">
              <button class="btn ghost" id="mapBtn2" type="button">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
            </div>
          </article>

          <article class="card sm-4" aria-labelledby="dressTitle">
            <h3 id="dressTitle">–î—Ä–µ—Å—Å‚Äë–∫–æ–¥</h3>
            <p>–î—Ä–µ—Å—Å‚Äë–∫–æ–¥–∞ –Ω–µ—Ç. –ù–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–µ —Ñ–æ—Ç–æ—á–∫–∏ ‚Äî –≤—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞—Ç—å üòâ</p>
          </article>
        </div>
      </div>
    </section>

    <!-- SCHEDULE -->
    <section id="schedule">
      <div class="container">
        <h2 class="section-title">–ü—Ä–æ–≥—Ä–∞–º–º–∞</h2>
        <div class="card">
          <div class="timeline" id="timeline">
            <div class="t-item"><div class="t-time">16:00</div><div>–°–±–æ—Ä –≥–æ—Å—Ç–µ–π, welcome‚Äë—Ñ–æ—Ç–æ –∏ –Ω–∞–ø–∏—Ç–∫–∏</div></div>
            <div class="t-item"><div class="t-time">17:00</div><div>–¶–µ—Ä–µ–º–æ–Ω–∏—è</div></div>
            <div class="t-item"><div class="t-time">18:00</div><div>–£–∂–∏–Ω –∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</div></div>
            <div class="t-item"><div class="t-time">21:00</div><div>–¢–∞–Ω—Ü—ã –¥–æ —É–ø–∞–¥—É</div></div>
            <div class="t-item"><div class="t-time">23:00</div><div>–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–∫–∫–æ—Ä–¥</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- WISHLIST -->
    <section id="wishlist">
      <div class="container">
        <h2 class="section-title">–í–∏—à‚Äë–ª–∏—Å—Ç</h2>
        <p class="section-note">–ë—Ä–æ–Ω—å —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ–±—â–µ–π —Ç–∞–±–ª–∏—Ü–µ (Google Sheets) ‚Äî —Å–ø–∏—Å–æ–∫ –≤–∏–¥—è—Ç –≤—Å–µ –≥–æ—Å—Ç–∏. –î–ª—è –±—Ä–æ–Ω–∏ —É–∫–∞–∂–∏—Ç–µ –∏–º—è; —Å–Ω—è—Ç—å –±—Ä–æ–Ω—å –º–æ–∂–Ω–æ —Å —Ç–æ–≥–æ –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–ø–æ —Ç–æ–∫–µ–Ω—É) –∏–ª–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.</p>

        <div class="filters">
          <label><input type="checkbox" id="onlyFree"> –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ</label>
        </div>

        <div class="wish-grid" id="wishGrid" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º: <a href="tel:+79032274106" aria-label="–¢–µ–ª–µ—Ñ–æ–Ω" style="color:inherit; font-weight:700; text-decoration:none;">+7 (903) 227‚Äë41‚Äë06</a>
      <br/>–° –ª—é–±–æ–≤—å—é, <span id="footerNames">–ò–º—è & –ò–º—è</span>
    </div>
  </footer>

  <script>
    // === –ù–ê–°–¢–†–û–ô–ö–ò –®–ê–ë–õ–û–ù–ê ===
    // –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∏–∂–µ ‚Äî –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤—è—Ç—Å—è –ø–æ –≤—Å–µ–º—É —Å–∞–π—Ç—É
    const WEDDING = {
      couple: '–†—É—Å–ª–∞–Ω & –ï–ª–∏–∑–∞–≤–µ—Ç–∞',         // –ò–º–µ–Ω–∞
      dateISO: '2025-08-30',       // –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
      timeStart: '13:50',          // –í—Ä–µ–º—è —Å–±–æ—Ä–∞ –≥–æ—Å—Ç–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ–µ)
      timeCeremony: '15:00',
      timeEnd: '23:00',
      timezone: 'Europe/Moscow',   // TZID –¥–ª—è .ics (–∑–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
      venueName: '–ú–æ—Å–∫–æ—É‚Äë–°–∏—Ç–∏, –±–∞—à–Ω—è –û–ö–û ‚Äî —Ä–µ—Å—Ç–æ—Ä–∞–Ω ¬´Birds¬ª',
      address: '1-–π –ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∏–π –ø—Ä-–¥, 21 —Å—Ç—Ä. 2, 84 —ç—Ç–∞–∂',
      mapsUrl: 'https://yandex.ru/maps/?text=–ú–æ—Å–∫–æ—É-—Å–∏—Ç–∏%20–±–∞—à–Ω—è%20–û–ö–û%20Birds%2084%20—ç—Ç–∞–∂',                // –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google/Yandex/2–ì–ò–°
    };

    // –ü—Ä–∏–º–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ/–¥–æ–ø–æ–ª–Ω—è–π—Ç–µ
    const WISHLIST = [
      { id: 'coffee',   title: '–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞',          note: 'De‚ÄôLonghi Magnifica S', price: '~40‚ÄØ000 ‚ÇΩ', link: '#' },
      { id: 'vacuum',   title: '–†–æ–±–æ—Ç‚Äë–ø—ã–ª–µ—Å–æ—Å',       note: '—Å –ª–∏–¥–∞—Ä–æ–º',             price: '~25‚ÄØ000 ‚ÇΩ', link: '#' },
      { id: 'trip',     title: '–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –æ—Ç–¥—ã—Ö', note: '–û—Ç 10‚ÄØ000 ‚ÇΩ', price: '–ª—é–±–æ–π –Ω–æ–º–∏–Ω–∞–ª', link: '#' },
      { id: 'dishes',   title: '–ù–∞–±–æ—Ä –ø–æ—Å—É–¥—ã',        note: '—Å—Ç–∏–ª—å –º–∏–Ω–∏–º–∞–ª–∏–∑–º',      price: '~12‚ÄØ000 ‚ÇΩ', link: '#' },
      { id: 'bedding',  title: '–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å—ë',    note: '—Å–∞—Ç–∏–Ω, 200√ó220',        price: '~8‚ÄØ000 ‚ÇΩ',  link: '#' },
      { id: 'mixer',    title: '–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã–π –º–∏–∫—Å–µ—Ä',  note: '—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –Ω–∞—Å–∞–¥–∫–∞–º–∏', price: '~18‚ÄØ000 ‚ÇΩ', link: '#' },
      { id: 'art',      title: '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –≥–∞–ª–µ—Ä–µ—é',note: '–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –≤—ã–±–æ—Ä',   price: '–æ—Ç 5‚ÄØ000 ‚ÇΩ', link: '#' },
      { id: 'cash',     title: '–ü–æ–∂–µ–ª–∞–π—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç üòä', note: '–ª—é–±–∞—è —Å—É–º–º–∞',           price: '',          link: '#' },
    ];

    // === API (Google Sheets Apps Script) ===
    const API_URL = 'https://script.google.com/macros/s/AKfycbzRsptiV_kMoljVjMwGehHmbJWXSq4QOF5PPJeRaBX_658NZMUMIuhwgG5SnroiFBWL4Q/exec';
    async function apiList() {
      const res = await fetch(`${API_URL}?action=list`, { method: 'GET' });
      return res.json();
    }
    async function apiReserve(item_id, name) {
      const body = new URLSearchParams({ action: 'reserve', item_id, name });
      const res = await fetch(API_URL, { method: 'POST', body });
      return res.json();
    }
    async function apiCancel(item_id, token) {
      const body = new URLSearchParams({ action: 'cancel', item_id, token });
      const res = await fetch(API_URL, { method: 'POST', body });
      return res.json();
    }

    // === –£–¢–ò–õ–ò–¢–´ –î–ê–¢/–§–û–†–ú–ê–¢–û–í ===
    const dt = new Date(WEDDING.dateISO + 'T' + (WEDDING.timeStart || '12:00'));
    const dateFormatter = new Intl.DateTimeFormat('ru-RU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    const prettyDate = (d) => dateFormatter.format(d).replace(/^./, c => c.toUpperCase());

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–µ–¥–µ—Ä–∞/–≥–µ—Ä–æ—è/–¥–µ—Ç–∞–ª–µ–π
    function hydrateBasics() {
      document.getElementById('coupleNames').textContent = WEDDING.couple;
      document.getElementById('footerNames').textContent = WEDDING.couple;
      document.getElementById('dateChip').textContent = prettyDate(dt);
      document.getElementById('dateText').textContent = dt.toLocaleDateString('ru-RU');
      document.getElementById('startTime').textContent = WEDDING.timeStart;
      document.getElementById('ceremonyTime').textContent = WEDDING.timeCeremony;
      document.getElementById('venueName').textContent = WEDDING.venueName;
      document.getElementById('venueAddr').textContent = WEDDING.address;
      document.title = `–°–≤–∞–¥—å–±–∞ ‚Äî ${WEDDING.couple}`;
    }

    // === –ö–ê–õ–ï–ù–î–ê–†–¨ (.ICS) ===
    function downloadICS() {
      // –§–æ—Ä–º–∏—Ä—É–µ–º DTSTART/DTEND –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å TZID (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ UTC)
      const compact = (s) => s.replace(/[-:]/g, '');
      const DTSTART = compact(WEDDING.dateISO) + 'T' + compact(WEDDING.timeStart);
      const DTEND   = compact(WEDDING.dateISO) + 'T' + compact(WEDDING.timeEnd);

      const lines = [
        'BEGIN:VCALENDAR',
        'VERSION:2.0',
        'PRODID:-//Wedding Invite//Template//RU',
        'CALSCALE:GREGORIAN',
        'METHOD:PUBLISH',
        'BEGIN:VEVENT',
        `UID:${crypto.randomUUID()}@wedding`,
        `DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').replace(/\..+/, 'Z')}`,
        `DTSTART;TZID=${WEDDING.timezone}:${DTSTART}`,
        `DTEND;TZID=${WEDDING.timezone}:${DTEND}`,
        `SUMMARY:–°–≤–∞–¥—å–±–∞ ‚Äî ${WEDDING.couple}`,
        `LOCATION:${WEDDING.venueName}, ${WEDDING.address}`,
        'DESCRIPTION:–ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å!',
        'END:VEVENT',
        'END:VCALENDAR'
      ].join('\r\n');

      const blob = new Blob([lines], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), { href: url, download: 'wedding.ics' });
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // === –ö–ê–†–¢–ê ===
    function openMap() {
      if (!WEDDING.mapsUrl || WEDDING.mapsUrl === '#') {
        alert('–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö WEDDING.mapsUrl');
        return;
      }
      window.open(WEDDING.mapsUrl, '_blank', 'noopener');
    }

    // === –í–ò–®‚Äë–õ–ò–°–¢ ===
    const grid = document.getElementById('wishGrid');
    const onlyFree = document.getElementById('onlyFree');

    // –õ–æ–∫–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω –æ—Ç–º–µ–Ω—ã; –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏ –±–µ—Ä—ë–º —Å —Å–µ—Ä–≤–µ—Ä–∞
    function getToken(id){ return localStorage.getItem('wish_token_'+id) || ''; }
    function setToken(id,t){ localStorage.setItem('wish_token_'+id, t); }
    function clearToken(id){ localStorage.removeItem('wish_token_'+id); }

    let SERVER_MAP = {}; // item_id -> name (–∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏)

    async function refreshFromServer() {
      try {
        const { ok, reservations } = await apiList();
        if (ok) SERVER_MAP = reservations || {};
      } catch (e) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–µ–π', e);
      }
    }

    function isReserved(id) { return Boolean(SERVER_MAP[id]); }
    function reservedName(id) { return SERVER_MAP[id] || ''; }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m])); }

    async function renderWishlist() {
      await refreshFromServer();
      grid.innerHTML = '';
      const filtered = WISHLIST.filter(item => !(onlyFree.checked && isReserved(item.id)));
      for (const item of filtered) {
        const reserved = isReserved(item.id);
        const owner = reservedName(item.id);
        const nameLabel = reserved ? `–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ ‚Äî ${escapeHtml(owner)}` : '–°–≤–æ–±–æ–¥–Ω–æ';
        const card = document.createElement('div');
        card.className = 'wish-card';
        card.innerHTML = `
          <div class="wish-thumb" aria-hidden="true">üéÅ</div>
          <div class="wish-meta">
            <h4 class="wish-title" title="${escapeHtml(item.title)}">${escapeHtml(item.title)}</h4>
            <p class="wish-note">${escapeHtml(item.note || '')} ${item.price ? '‚Ä¢ '+escapeHtml(item.price) : ''}</p>
          </div>
          <div class="wish-actions">
            <a class="btn ghost" href="${item.link || '#'}" target="_blank" rel="noopener">–°–º–æ—Ç—Ä–µ—Ç—å</a>
            <span class="pill badge ${reserved ? 'reserved' : 'free'}">${nameLabel}</span>
            <button class="btn primary" aria-pressed="${reserved}" data-id="${item.id}">${reserved ? '–°–Ω—è—Ç—å –±—Ä–æ–Ω—å' : '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'}</button>
          </div>`;

        card.querySelector('button').addEventListener('click', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          if (!isReserved(id)) {
            let name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫:');
            if (!name) return; name = name.trim();
            if (name.length < 2) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è (–Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤).'); return; }
            const r = await apiReserve(id, name);
            if (!r || !r.ok) { alert(r && r.error === 'already_reserved' ? '–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ —É–∂–µ —É—Å–ø–µ–ª–∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å.' : '–û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.'); return; }
            setToken(id, r.token);
            await renderWishlist();
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±—Ä–æ–Ω–µ–π
    setInterval(renderWishlist, 30000);
    document.addEventListener('visibilitychange', () => { if (!document.hidden) renderWishlist(); });
          } else {
            const token = getToken(id);
            if (!token) { alert('–°–Ω—è—Ç—å –±—Ä–æ–Ω—å –º–æ–∂–Ω–æ —Å —Ç–æ–≥–æ –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –≥–¥–µ –æ–Ω–∞ –æ—Ñ–æ—Ä–º–ª—è–ª–∞—Å—å, –ª–∏–±–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.'); return; }
            const r = await apiCancel(id, token);
            if (!r || !r.ok) { alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–Ω—è—Ç—å –±—Ä–æ–Ω—å.'); return; }
            clearToken(id);
            await renderWishlist();
          }
        });
        grid.appendChild(card);
      }
      if (!filtered.length) {
        const empty = document.createElement('div');
        empty.className = 'card';
        empty.textContent = '–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.';
        grid.appendChild(empty);
      }
    }

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    hydrateBasics();
    renderWishlist();

    document.getElementById('icsBtn').addEventListener('click', downloadICS);
    document.getElementById('heroIcs').addEventListener('click', downloadICS);
    document.getElementById('mapBtn').addEventListener('click', openMap);
    document.getElementById('heroMap').addEventListener('click', openMap);
    document.getElementById('mapBtn2').addEventListener('click', openMap);
    onlyFree.addEventListener('change', renderWishlist);
  </script>
</body>
</html>
