<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–≤–∞–¥—å–±–∞ ‚Äî –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</title>
  <meta name="description" content="–®–∞–±–ª–æ–Ω —Å–∞–π—Ç–∞‚Äë–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ —Å–≤–∞–¥—å–±—É: –¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏ –≤–∏—à‚Äë–ª–∏—Å—Ç." />
  <meta property="og:title" content="–°–≤–∞–¥–µ–±–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ" />
  <meta property="og:description" content="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É –ø—Ä–∞–∑–¥–Ω–∏–∫—É! –ó–¥–µ—Å—å ‚Äî –¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏ –≤–∏—à‚Äë–ª–∏—Å—Ç." />
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root {
      --bg: #f8fafc;
      --bg-2: #ffffff;
      --text: #0b1020;
      --muted: #5b6475;
      --accent: #7c5cff;
      --accent-2: #00c4b3;
      --danger: #ef4444;
      --ok: #10b981;

      --r-lg: 24px;
      --r-md: 16px;
      --r-sm: 10px;
      --shadow-s: 0 1px 2px rgba(16, 24, 40, .06), 0 4px 12px rgba(16, 24, 40, .06);
      --shadow-m: 0 12px 24px rgba(16, 24, 40, .12);

      --container: 1100px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 400px at 10% -10%, rgba(124,92,255,.12), transparent 60%),
        radial-gradient(1200px 400px at 90% 0%, rgba(0,196,179,.10), transparent 60%),
        linear-gradient(180deg, #fff, var(--bg));
    }

    .container { max-width: var(--container); margin: 0 auto; padding: 24px; }

    header {
      position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(140%) blur(8px);
      background: color-mix(in srgb, #ffffff 80%, transparent);
      border-bottom: 1px solid #e8ecf3;
    }
    .nav { display: flex; align-items: center; gap: 16px; padding: 14px 24px; }
    .brand { font-weight: 700; letter-spacing: .3px; }
    .nav a { color: var(--muted); text-decoration: none; font-weight: 600; }
    .nav a:hover { color: var(--text); }
    .spacer { flex: 1; }
    .btn { appearance: none; border: none; border-radius: 999px; padding: 12px 18px; font-weight: 700; cursor: pointer; }
    .btn.primary { background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: #fff; box-shadow: var(--shadow-s); }
    .btn.ghost { background: #fff; color: var(--text); border: 1px solid #e8ecf3; }

    .hero { padding: 56px 24px 32px; text-align: center; }
    .chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 14px; border-radius: 999px; background: #fff; border: 1px solid #e8ecf3; color: var(--muted); font-weight: 600; box-shadow: var(--shadow-s); }
    h1 { font-size: clamp(40px, 6vw, 72px); margin: 18px 0 8px; line-height: 1.03; letter-spacing: -0.5px; }
    .names { background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .subtitle { color: var(--muted); font-size: clamp(18px, 2.8vw, 22px); }

    .cta { display: flex; justify-content: center; gap: 12px; margin-top: 24px; flex-wrap: wrap; }

    section { padding: 48px 0; }
    .section-title { font-size: clamp(26px, 3.4vw, 36px); margin: 0 0 16px; }
    .section-note { color: var(--muted); margin: 0 0 24px; }

    .pass-warning {
      display: inline-block;
      padding: 2px 8px;
      background: var(--danger);
      color: #fff;
      border-radius: var(--r-sm);
      font-weight: 700;
    }

    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .card { grid-column: span 12; background: var(--bg-2); border: 1px solid #e8ecf3; border-radius: var(--r-lg); box-shadow: var(--shadow-s); padding: 20px; }
    @media (min-width: 720px) { .card.sm-6 { grid-column: span 6; } .card.sm-4 { grid-column: span 4; } }

    .card h3 { margin: 2px 0 6px; font-size: 18px; letter-spacing: .2px; }
    .card p { margin: 0; color: var(--muted); }

    .timeline { position: relative; padding-left: 20px; }
    .timeline::before { content:""; position:absolute; left:8px; top:0; bottom:0; width:2px; background:#e8ecf3; }
    .t-item { position:relative; padding:14px 0 14px 12px; }
    .t-item::before { content:""; position:absolute; left:-2px; top:20px; width:10px; height:10px; background: var(--accent); border-radius:50%; box-shadow: 0 0 0 3px #f0edff; }
    .t-time { font-weight: 700; }

    .wish-grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .wish-card { grid-column: span 12; background:#fff; border:1px solid #edf0f6; border-radius: var(--r-md); padding:16px; display:flex; flex-wrap:wrap; gap:14px; align-items:center; box-shadow: var(--shadow-s); }
    @media (min-width: 760px) { .wish-card { grid-column: span 6; } }
    @media (min-width: 1024px) { .wish-card { grid-column: span 4; } }
    .wish-thumb { width:64px; height:64px; border-radius: 12px; background: linear-gradient(120deg, rgba(124,92,255,.12), rgba(0,196,179,.12)); display:flex; align-items:center; justify-content:center; color: var(--accent); overflow:hidden; }
    .wish-thumb img { width:100%; height:100%; object-fit:cover; }
    .wish-icon { width:32px; height:32px; stroke:currentColor; stroke-width:2; fill:none; }
    .wish-meta { flex:1; min-width:0; }
    .wish-title { margin:0 0 4px; font-weight:800; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .wish-note { margin:0; color: var(--muted); font-size:14px; }
    .wish-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-left:auto; }
    .pill { padding:6px 10px; border-radius:999px; background:#f1f5f9; color:#334155; font-size:12px; font-weight:700; }
    .badge.reserved { background: #fef2f2; color: #991b1b; border: 1px dashed #fecaca; }
    .badge.free { background:#edfdf7; color:#065f46; border: 1px dashed #a7f3d0; }

    @media (max-width: 480px) {
      .container { padding: 16px; }
      .nav { flex-wrap: wrap; justify-content: center; }
      .cta { flex-direction: column; }
      .cta .btn { width: 100%; }
      .pass-warning { display: block; margin-top: 6px; }
    }

    .filters { display:flex; gap:10px; align-items:center; margin-bottom: 12px; }

    footer { padding: 36px 24px 56px; color: var(--muted); text-align:center; }

    @media (prefers-reduced-motion: no-preference) {
      .hero h1 { animation: rise .8s ease-out both; }
      @keyframes rise { from { opacity: 0; transform: translateY(6px); } to { opacity:1; transform:none; } }
    }
  </style>
 </head>
 
 <body>
   <header>
     <nav class="nav">
       <span class="brand">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</span>
       <a href="#details">–î–µ—Ç–∞–ª–∏</a>
       <a href="#schedule">–ü—Ä–æ–≥—Ä–∞–º–º–∞</a>
       <a href="#wishlist">–ü–æ–¥–∞—Ä–∫–∏</a>
       <span class="spacer"></span>
       <button id="heroIcs" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
       <button id="heroMap" class="btn ghost">–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è</button>
     </nav>
   </header>
 
   <main>
     <section class="hero">
       <div id="dateChip" class="chip"></div>
       <h1 class="names" id="coupleNames"></h1>
       <p class="subtitle">–ñ–¥—ë–º –≤–∞—Å <span id="dateTextHero"></span></p>
       <div class="cta">
         <button id="icsBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
         <button id="mapBtn" class="btn ghost">–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è</button>
       </div>
     </section>
 
     <section id="details">
       <div class="container">
         <h2 class="section-title">–î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è</h2>
         <p class="section-note">–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ —á—É—Ç—å –∑–∞—Ä–∞–Ω–µ–µ. <span class="pass-warning">‚ö†Ô∏è –í—Ö–æ–¥ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–æ–ø—É—Å–∫–∞–º, –ø–æ—ç—Ç–æ–º—É
             –Ω–µ –æ–ø–∞–∑–¥—ã–≤–∞—Ç—å!!!</span></p>
 
         <div class="grid">
           <article class="card sm-4" aria-labelledby="whenTitle">
             <h3 id="whenTitle">–ö–æ–≥–¥–∞</h3>
             <p><strong id="dateText"></strong> –≤ <strong id="mainTime"></strong></p>
             <p>–°–±–æ—Ä –≥–æ—Å—Ç–µ–π ‚Äî <strong id="startTime"></strong>, —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å ‚Äî <strong id="ceremonyTime"></strong>
             </p>
           </article>
 
           <article class="card sm-4" aria-labelledby="whereTitle">
             <h3 id="whereTitle">–ì–¥–µ</h3>
             <p id="venueName"></p>
             <p id="venueAddr"></p>
             <div style="margin-top:10px; display:flex; gap:8px;">
               <button id="mapBtn2" class="btn ghost">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
             </div>
           </article>
 
           <article class="card sm-4" aria-labelledby="dressTitle">
             <h3 id="dressTitle">–î—Ä–µ—Å—Å‚Äë–∫–æ–¥</h3>
             <p>–î—Ä–µ—Å—Å‚Äë–∫–æ–¥–∞ –Ω–µ—Ç. –ù–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–µ —Ñ–æ—Ç–æ—á–∫–∏ ‚Äî –≤—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞—Ç—å üòâ</p>
           </article>
         </div>
       </div>
     </section>
 
     <section id="schedule">
       <div class="container">
         <h2 class="section-title">–ü—Ä–æ–≥—Ä–∞–º–º–∞</h2>
         <div class="card">
           <div class="timeline" id="timeline">
             <div class="t-item">
               <div class="t-time" id="tStart"></div>
               <div>–°–±–æ—Ä –≥–æ—Å—Ç–µ–π</div>
             </div>
             <div class="t-item">
               <div class="t-time" id="tCeremony"></div>
               <div>–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ –±–∞—à–Ω—é</div>
             </div>
             <div class="t-item">
               <div class="t-time" id="tMain"></div>
               <div>–¶–µ—Ä–µ–º–æ–Ω–∏—è</div>
             </div>
             <div class="t-item">
               <div class="t-time" id="tEnd"></div>
               <div>–ö–æ–Ω–µ—Ü</div>
             </div>
           </div>
         </div>
       </div>
     </section>
 
     <section id="wishlist">
       <div class="container">
         <h2 class="section-title">–í–∏—à‚Äë–ª–∏—Å—Ç</h2>
         <p class="section-note">–ï—Å–ª–∏ –≤—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —Å–¥–µ–ª–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫, –Ω–æ –Ω–µ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ –∏ –∫–∞–∫, —Ç–æ –º—ã –ø–æ–¥–æ–±—Ä–∞–ª–∏ —Å–ø–∏—Å–æ–∫
           –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤, —á—Ç–æ–±—ã –æ–±–ª–µ–≥—á–∏—Ç—å –≤–∞–º –∂–∏–∑–Ω—å. –ü–æ–¥–∞—Ä–æ–∫ –º–æ–∂–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ–º, —á—Ç–æ
           –∫—Ç–æ-—Ç–æ —Ä–µ—à–∏—Ç –ø–æ–¥–∞—Ä–∏—Ç—å —Ç–æ–∂–µ —Å–∞–º–æ–µ.</p>
         <div class="filters">
           <label><input type="checkbox" id="onlyFree" /> –¢–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ</label>
         </div>
         <div id="wishGrid" class="wish-grid"></div>
       </div>
     </section>
   </main>
 
   <footer>
     <div class="container">
       –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º: <a href="tel:+79032274106" aria-label="–¢–µ–ª–µ—Ñ–æ–Ω"
         style="color:inherit; font-weight:700; text-decoration:none;">+7 (903) 227‚Äë41‚Äë06</a>
       <br />–° –ª—é–±–æ–≤—å—é, <span id="footerNames">–ò–º—è &amp; –ò–º—è</span>
     </div>
   </footer>
 
   <script>
     // === –ù–ê–°–¢–†–û–ô–ö–ò –®–ê–ë–õ–û–ù–ê ===
     const WEDDING = {
       couple: '–†—É—Å–ª–∞–Ω & –ï–ª–∏–∑–∞–≤–µ—Ç–∞',
       dateISO: '2025-08-30',
       timeMain: '15:00',
       timeStart: '13:50',
       timeCeremony: '14:30',
       timezone: 'Europe/Moscow',
       timeEnd: '16:00',
      venueName: '–ú–æ—Å–∫–æ—É‚Äë–°–∏—Ç–∏, –±–∞—à–Ω—è –û–ö–û ‚Äî —Ä–µ—Å—Ç–æ—Ä–∞–Ω ¬´Birds¬ª',
      address: '1-–π –ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∏–π –ø—Ä-–¥, 21 —Å—Ç—Ä. 2, 84 —ç—Ç–∞–∂',
      mapsUrl: 'https://yandex.ru/maps/?text=–ú–æ—Å–∫–æ—É-—Å–∏—Ç–∏%20–±–∞—à–Ω—è%20–û–ö–û%20Birds%2084%20—ç—Ç–∞–∂'
    };

      const WISHLIST = [
      {
        id: 'aerogrill',
        title: '–ê—ç—Ä–æ–≥—Ä–∏–ª—å',
        link: 'https://www.wildberries.ru/catalog/252986314/detail.aspx?size=394996892',
        image: 'image/–∞—ç—Ä–æ–≥—Ä–∏–ª—å.png'
      },
      {
        id: 'tableware',
        title: '–°—Ç–æ–ª–æ–≤—ã–π —Å–µ—Ä–≤–∏–∑',
        link: 'https://www.wildberries.ru/catalog/212966249/detail.aspx?size=340398755',
        image: 'image/—Å—Ç–æ–ª–æ–≤—ã–π_—Å–µ—Ä–≤–∏–∑.png'
      },
      {
        id: 'bedding1',
        title: '–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å—ë 1',
        link: 'https://www.wildberries.ru/catalog/275416950/detail.aspx?size=424599294',
        image: 'image/–ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ_–±–µ–ª—å—ë.png'
      },
      {
        id: 'bedding2',
        title: '–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å—ë 2',
        link: 'https://www.wildberries.ru/catalog/232577407/detail.aspx?size=366852213',
        image: 'image/–ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ_–±–µ–ª—å—ë_2.png'
      }
      ];
    </script>
    <script>
      const API_URL = 'https://script.google.com/macros/s/AKfycbx1fLicJpLrPtOi-fIhGM8RpGWuv9mWMH38Mnqr9cK9TNj_cTwtTlYXoJc0uIklgF-RDw/exec';

      async function apiList() {
        const res = await fetch(`${API_URL}?action=list`, { method: 'GET' });
        return res.json();
      }
      async function apiReserve(item_id, name) {
        const body = new URLSearchParams({ action: 'reserve', item_id, name });
        const res = await fetch(API_URL, { method: 'POST', body });
        return res.json();
      }
      async function apiCancel(item_id, token) {
        const body = new URLSearchParams({ action: 'cancel', item_id, token });
        const res = await fetch(API_URL, { method: 'POST', body });
        return res.json();
      }
    </script>
    <script>
      // === –£–¢–ò–õ–ò–¢–´ –î–ê–¢/–§–û–†–ú–ê–¢–û–í ===
      const dt = new Date(WEDDING.dateISO + 'T' + (WEDDING.timeStart || '12:00'));
    const dateFormatter = new Intl.DateTimeFormat('ru-RU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    const prettyDate = (d) => dateFormatter.format(d).replace(/^./, c => c.toUpperCase());

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    function hydrateBasics() {
      document.getElementById('coupleNames').textContent = WEDDING.couple;
      document.getElementById('footerNames').textContent = WEDDING.couple;
      document.getElementById('dateChip').textContent = prettyDate(dt);
      document.getElementById('dateText').textContent = dt.toLocaleDateString('ru-RU');
      const dateHero = document.getElementById('dateTextHero');
      if (dateHero) dateHero.textContent = dt.toLocaleDateString('ru-RU');
      document.getElementById('mainTime').textContent = WEDDING.timeMain;
      document.getElementById('startTime').textContent = WEDDING.timeStart;
      document.getElementById('ceremonyTime').textContent = WEDDING.timeCeremony;
      const tStart = document.getElementById('tStart');
      if (tStart) tStart.textContent = WEDDING.timeStart;
      const tCer = document.getElementById('tCeremony');
      if (tCer) tCer.textContent = WEDDING.timeCeremony;
      const tMain = document.getElementById('tMain');
      if (tMain) tMain.textContent = WEDDING.timeMain;
      const tEnd = document.getElementById('tEnd');
      if (tEnd) tEnd.textContent = WEDDING.timeEnd;
      document.getElementById('venueName').textContent = WEDDING.venueName;
      document.getElementById('venueAddr').textContent = WEDDING.address;
      document.title = `–°–≤–∞–¥—å–±–∞ ‚Äî ${WEDDING.couple}`;
    }

    // === –ö–ê–õ–ï–ù–î–ê–†–¨ (.ICS) ===
    function downloadICS() {
      const compact = (s) => s.replace(/[-:]/g, '');
      const dtStart = `${compact(WEDDING.dateISO)}T${compact(WEDDING.timeMain || '12:00')}00`;
      const dtEnd = `${compact(WEDDING.dateISO)}T${compact(WEDDING.timeEnd || WEDDING.timeMain)}00`;
      const ics = `BEGIN:VCALENDAR\r\nVERSION:2.0\r\nBEGIN:VEVENT\r\nDTSTAMP:${dtStart}\r\nDTSTART;TZID=${WEDDING.timezone}:${dtStart}\r\nDTEND;TZID=${WEDDING.timezone}:${dtEnd}\r\nSUMMARY:${WEDDING.couple}\r\nLOCATION:${WEDDING.venueName}, ${WEDDING.address}\r\nEND:VEVENT\r\nEND:VCALENDAR`;
      const blob = new Blob([ics], { type: 'text/calendar' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'wedding.ics';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
    }

    // === –ö–ê–†–¢–ê ===
    function openMap() {
      if (WEDDING.mapsUrl) {
        window.open(WEDDING.mapsUrl, '_blank', 'noopener');
      }
    }

      // === –í–ò–®-–õ–ò–°–¢ ===
      const grid = document.getElementById('wishGrid');
      const onlyFree = document.getElementById('onlyFree');

      // –õ–æ–∫–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω –æ—Ç–º–µ–Ω—ã; –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏ –±–µ—Ä—ë–º —Å —Å–µ—Ä–≤–µ—Ä–∞
      function getToken(id){ return localStorage.getItem('wish_token_'+id) || ''; }
      function setToken(id,t){ localStorage.setItem('wish_token_'+id, t); }
      function clearToken(id){ localStorage.removeItem('wish_token_'+id); }

      let SERVER_MAP = {}; // item_id -> name (–∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏)

      async function refreshFromServer() {
        try {
          const { ok, reservations } = await apiList();
          if (ok) SERVER_MAP = reservations || {};
        } catch (e) {
          console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–µ–π', e);
        }
      }

      function isReserved(id) { return Boolean(SERVER_MAP[id]); }
      function reservedName(id) { return SERVER_MAP[id] || ''; }
      function escapeHtml(s) {
        return (s || '').replace(/[&<>"']/g, m => ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        })[m]);
      }

      async function renderWishlist() {
        await refreshFromServer();
        grid.innerHTML = '';
        const filtered = WISHLIST.filter(item => !(onlyFree.checked && isReserved(item.id)));
        for (const item of filtered) {
          const reserved = isReserved(item.id);
          const owner = reservedName(item.id);
          const nameLabel = reserved ? `–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ ‚Äî ${escapeHtml(owner)}` : '–°–≤–æ–±–æ–¥–Ω–æ';

          const card = document.createElement('div');
          card.className = 'wish-card';
          const safeLink = /^https?:\/\//i.test(item.link || '') ? item.link : '#';
          card.innerHTML = `
            <div class="wish-thumb" aria-hidden="true">üéÅ</div>
            <div class="wish-meta">
              <h4 class="wish-title" title="${escapeHtml(item.title)}">${escapeHtml(item.title)}</h4>
              <p class="wish-note">${escapeHtml(item.note || '')} ${item.price ? '‚Ä¢ '+escapeHtml(item.price) : ''}</p>
            </div>
            <div class="wish-actions">
              <a class="btn ghost" href="${safeLink}" target="_blank" rel="noopener">–°–º–æ—Ç—Ä–µ—Ç—å</a>
              <span class="pill badge ${reserved ? 'reserved' : 'free'}">${nameLabel}</span>
              <button class="btn primary" aria-pressed="${reserved}" data-id="${item.id}">
                ${reserved ? '–°–Ω—è—Ç—å –±—Ä–æ–Ω—å' : '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'}
              </button>
            </div>`;

          card.querySelector('button').addEventListener('click', async (e) => {
            const id = e.currentTarget.getAttribute('data-id');
            if (!isReserved(id)) {
              let name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫:');
              if (!name) return;
              name = name.trim();
              if (name.length < 2) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è (–Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤).'); return; }
              const r = await apiReserve(id, name);
              if (!r || !r.ok) {
                alert(r && r.error === 'already_reserved' ? '–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ —É–∂–µ —É—Å–ø–µ–ª–∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å.' : '–û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
                return;
              }
              setToken(id, r.token);
              await renderWishlist();
            } else {
              const token = getToken(id);
              if (!token) { alert('–°–Ω—è—Ç—å –±—Ä–æ–Ω—å –º–æ–∂–Ω–æ —Å —Ç–æ–≥–æ –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –≥–¥–µ –æ–Ω–∞ –æ—Ñ–æ—Ä–º–ª—è–ª–∞—Å—å, –ª–∏–±–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.'); return; }
              const r = await apiCancel(id, token);
              if (!r || !r.ok) { alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–Ω—è—Ç—å –±—Ä–æ–Ω—å.'); return; }
              clearToken(id);
              await renderWishlist();
            }
          });

          grid.appendChild(card);
        }
        if (!filtered.length) {
          const empty = document.createElement('div');
          empty.className = 'card';
          empty.textContent = '–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.';
          grid.appendChild(empty);
        }
      }

      hydrateBasics();
      renderWishlist();
      setInterval(renderWishlist, 30000);
      document.addEventListener('visibilitychange', () => { if (!document.hidden) renderWishlist(); });

      const timelineEl = document.getElementById('timeline');
    if (timelineEl) {
      const observer = new IntersectionObserver((entries, obs) => {
        if (entries[0].isIntersecting) {
          timelineEl.classList.add('animate');
          obs.disconnect();
        }
      }, { threshold: 0.2 });
      observer.observe(timelineEl);
    }

    document.getElementById('icsBtn').addEventListener('click', downloadICS);
    document.getElementById('heroIcs').addEventListener('click', downloadICS);
    document.getElementById('mapBtn').addEventListener('click', openMap);
    document.getElementById('heroMap').addEventListener('click', openMap);
    document.getElementById('mapBtn2').addEventListener('click', openMap);
    onlyFree.addEventListener('change', renderWishlist);
  </script>
</body>
</html>

